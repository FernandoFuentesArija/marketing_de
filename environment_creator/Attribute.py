from environment_creator.config import ConfigVariablesEnv
import random

class Attribute:
    """ Base class to manage attributes

    The environment is composed of objects. These objects have characteristics that define them. Those characteristics
    we are going to call them attributes and they are going to be generated by this class.
    We are going to have 5 different types of atributes:
    1-NUMBER: We can generate a list of numbers, randomly or in sequence. We also define the precision and the range.
    2-TEXT:
    3-DATE:
    4-COMBINED:
    5-CONDITIONED:
    Note: The list returned, can be of unique elements, or can have duplicates. It will be defined in the
    <attribute_constr> variable.

    ATTRIBUTES
    ---------
    It's composed:
    - self.bbdd: Object that represents the connection to the bbdd
    - self.att_dic: Dictionary with the recipe to create the attribute
    - self.att_num: Number of attributes to create (inside a list)

    METHODS
    -------
    - create_attribute
    - create_numbers
    - create_random_numbers

    PERSISTENCE
    ------------
    - El listado

    RELATIONS WITH OTHER ELEMENTS
    ------------------------------
    -[element name]: La
    """

    # Le pasamos una conexion a cada instancia (puede ser la misma)
    def __init__(self, ddbb_conn):
        """ For every instance we need 3 parameters
        :param ddbb_conn: Object that represents the connection to the bbdd
        """
        self.bbdd = ddbb_conn


    def create_numbers(self,list_length):
        """ This function creates a list of numbers
        The dictionary that will describe how to generate the list of numbers will have the following keys
        - 'PRECISION': Will describe the length of the decimal part.
           Ej: if we want describe 9999.99  Ej_dic: 'PRECISION':'2'
        - 'RANGE': Establish the integer range (min-max) where the number are going to be created.
           Ej: if we want numbers between 10 and 100  Ej_dic: 'RANGE':'10-100'
        - 'GENERATION': It describes how the numbers are going to be created. The can be create randomly or as a
           secuence with certain hop.
           Ej_dic: 'GENERATION':'RANDOM' or 'GENERATION':'SEQUENTIAL'
        - 'HOP': In a sequential number generation is the separation between generated numbers.
           Ej: if we want 2,4,6,...  Ej_dic: 'HOP':'2'
        :param list_length: number of numbers to generate and return in a list
        :return: list of numbers generated
        """
        # First we obtain all the relevant information that we need
        this_precision = self.att_dic[ConfigVariablesEnv.num_precision]
        this_range = self.att_dic[ConfigVariablesEnv.num_range]
        this_generation = self.att_dic[ConfigVariablesEnv.num_generation]
        # From the precision we obtain de decimal and integer accuracy
        dec_pre = int(this_precision)
        # From the range we obtain de max and min numbers
        min_rang, max_rang = this_range.split('-')
        min_rang = int(min_rang)
        max_rang = int(max_rang)
        # Depending on the type of generation
        if this_generation == ConfigVariablesEnv.num_gen_seq:
            # If the generation is sequential we need to recover the hop.
            this_hop_str = self.att_dic[ConfigVariablesEnv.num_hop]
            this_hop_int = int(this_hop_str)
            ret_list = self.create_seq_numbers(min_rang, max_rang, list_length, this_hop_int)
            return ret_list
        elif this_generation == ConfigVariablesEnv.num_gen_random:
            ret_list = self.create_random_numbers(dec_pre, min_rang, max_rang, list_length)
            return ret_list


    def create_random_numbers(self,decimal_prec,min_num, max_num, list_length):
        """ This function will create and return a list of random numbers
        :param decimal_prec: Number of digits for the decimal part
        :param min_num: Minimun number allowed
        :param max_num: Maximun number allowed
        :param list_length: number of numbers to generate and return in a list
        """
        # The list to return
        ret_list = []
        # We create the decimal deviation
        ten_mult = 10**decimal_prec
        # We escalate the range if we have decimals
        min_num_scal = min_num * ten_mult
        max_num_scal = max_num * ten_mult
        for i in range(list_length):
            new_num_scal = random.randint(min_num_scal,max_num_scal)
            new_num = new_num_scal / ten_mult
            ret_list.append(new_num)
        return ret_list

    def create_seq_numbers(self,min_num, max_num, list_length,hop):
        """ This function will create and return a list of sequence integer numbers
        :param decimal_prec: Number of digits for the decimal part
        :param min_num: Minimun number allowed
        :param max_num: Maximun number allowed
        :param list_length: number of numbers to generate and return in a list
        """
        # We use range
        new_range = range(min_num,max_num,hop)
        new_range_list = list(new_range)
        # Validation
        if len(new_range_list) != list_length:
            print("error")
        # Finish
        return new_range_list


    def create_attribute(self, att_dic, att_num):
        """ This is the single entry point to create a list of attributes
        :param att_dic: Dictionary with the recipe to create the attribute
        :param att_num: Number of attributes to create (inside a list)
        """
        self.att_dic = att_dic
        self.att_num = att_num
        # We obtain the type of attribute to decide how to process it
        this_type = att_dic[ConfigVariablesEnv.attribute_type]
        # Now depending on the type we call the specific creation method
        if this_type == ConfigVariablesEnv.att_type_number:
            ret_list = self.create_numbers(self.att_num)
            return ret_list
        elif this_type == ConfigVariablesEnv.att_type_text:
            pass
        elif this_type == ConfigVariablesEnv.att_type_date:
            pass
        elif this_type == ConfigVariablesEnv.att_type_combined:
            pass
        elif this_type == ConfigVariablesEnv.att_type_conditioned:
            pass
        else:
            print("error")
